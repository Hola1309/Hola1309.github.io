<!DOCTYPE html><html lang="en"><head><meta name="robots" content="follow, index"/><meta name="description" content="Clone and deploy your own Next.js portfolio in minutes."/><meta property="og:site_name" content="Next.js Blog Starter Kit"/><meta property="og:description" content="Clone and deploy your own Next.js portfolio in minutes."/><meta property="og:title" content="Next.js Blog Starter Kit"/><meta property="og:image" content="https://assets.vercel.com/image/upload/q_auto/front/vercel/dps.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@yourname"/><meta name="twitter:title" content="Next.js Blog Starter Kit"/><meta name="twitter:description" content="Clone and deploy your own Next.js portfolio in minutes."/><meta name="twitter:image" content="https://assets.vercel.com/image/upload/q_auto/front/vercel/dps.png"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"/><link rel="preload" href="/fonts/Inter-roman.latin.var.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><title>API-Security</title><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/css/5076a516e8a2b633.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5076a516e8a2b633.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-4ae51d4b0d2dc9a6.js" defer=""></script><script src="/_next/static/chunks/framework-d5c96c6d07ca9fe9.js" defer=""></script><script src="/_next/static/chunks/main-e47bb435dabe4202.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e89de317f965cd3b.js" defer=""></script><script src="/_next/static/chunks/353-9c855d83cc7ddaed.js" defer=""></script><script src="/_next/static/chunks/pages/posts/API-Security-6fb67a0a370a0e34.js" defer=""></script><script src="/_next/static/rjPBkcZE1RiLsuwTT0Glq/_buildManifest.js" defer=""></script><script src="/_next/static/rjPBkcZE1RiLsuwTT0Glq/_ssgManifest.js" defer=""></script><script src="/_next/static/rjPBkcZE1RiLsuwTT0Glq/_middlewareManifest.js" defer=""></script><style id="__jsx-ae369fc9d3d182f">a.jsx-ae369fc9d3d182f{float:right}
@media screen and (max-width:480px) {article.jsx-ae369fc9d3d182f{padding-top:2rem;
padding-bottom:4rem}}</style></head><body><div id="__next" data-reactroot=""><article class="container prose prose-sm md:prose dark:prose-dark"><h1>Контрольный список безопасности API</h1><div class="meta-line"><div class="meta">You<!-- -->, <time>Tue May 02 2023</time> • <a class="tag" href="/tags/API">API</a><a class="tag" href="/tags/Security">Security</a></div><a class="meta-back" href="/posts">Back</a></div>
<p>Чеклист наиболее важных контрмер по безопасности при разработке, тестировании и выпуске вашего API.</p>
<hr/>
<h2>Аутентификация</h2>
<ul>
<li>Не используйте <code>Basic Auth</code>. Используйте стандартную проверку подлинности (например: JWT, OAuth).</li>
<li>Не изобретайте велосипед для <code>аутентификации</code>, <code>создании токенов</code>, <code>хранения паролей</code>. Используйте стандарты, проверенные библиотеки.</li>
<li>Используйте <code>Max Retry</code> и функции jail во время аутентификации.</li>
<li>Используйте шифрование для всех конфиденциальных данных.</li>
</ul>
<h3>JWT (JSON Web Token)</h3>
<ul>
<li>Используйте случайный сложный ключ (<code>JWT Secret</code>), чтобы сделать брут форс токена бесполезным.</li>
<li>Не полагайтесь на переданное в заголовках название алгоритма, лучше закрепите его константой на сервере (<code>HS256</code> или <code>RS256</code>).</li>
<li>Сделайте срок действия токена (<code>TTL</code>, <code>RTTL</code>) как можно короче.</li>
<li>Не храните конфиденциальные данные в JWT, его можно <a href="https://jwt.io/#debugger-io">легко декодировать.</a>.</li>
<li>Избегайте хранения слишком большого количества данных. JWT обычно используется в header, и они имеют ограничение по размеру.</li>
</ul>
<h2>Доступ</h2>
<ul>
<li>Установите ограничение на кол-во запросов в минуту (Throttling, RPM-Limit), чтобы избежать DDoS / Brute Force атак.</li>
<li>Используйте HTTPS на стороне сервера, чтобы избежать <a href="https://ru.wikipedia.org/wiki/%D0%90%D1%82%D0%B0%D0%BA%D0%B0_%D0%BF%D0%BE%D1%81%D1%80%D0%B5%D0%B4%D0%BD%D0%B8%D0%BA%D0%B0">MITM</a> (Man In The Middle Attack / атака &quot;человек посередине&quot;).</li>
<li>Используйте заголовок <code>HSTS</code> (HTTP Strict Transport Security) с SSL, чтобы избежать атаки SSL Strip (перехват SSL соединений).</li>
<li>Отключите списки каталогов.</li>
<li>Для частных API, разрешите доступ только с IP-адресов/хостов из белого списка.</li>
</ul>
<h2>Авторизация</h2>
<h3>OAuth</h3>
<ul>
<li>Всегда проверяйте <code>redirect_uri</code> на стороне сервера, чтобы разрешать только URL-адреса из белых списков (whitelist).</li>
<li>Всегда старайтесь использовать одноразовый code, а не токены (не использовать <code>response_type=token</code>).</li>
<li>Используйте параметр <code>state</code> со случайным хешем, чтобы предотвратить CSRF в процессе аутентификации OAuth.</li>
<li>Определите scope по умолчанию, а также проверяйте параметры для каждого приложения.</li>
</ul>
<h2>Запрос</h2>
<ul>
<li>Используйте соответствующий HTTP-метод в соответствии с операцией: <code>GET (чтение)</code>, <code>POST (создание)</code>, <code>PUT / PATCH (замена / обновление)</code> и <code>DELETE (удаление)</code>, а также ответьте <code>405 Method Not Allowed</code>, если запрошенный метод не подходит для запрашиваемого ресурса.</li>
<li>Проверяй тип данных в заголовке <code>Accept</code>, чтобы разрешить только поддерживаемые форматы (например, <code>application/xml</code>, <code>application/json</code> и т.д.) И отвечайте <code>406 Not Acceptable</code>, если тип не поддерживается.</li>
<li>Проверяйте, сможете ли вы обработать тип получаемых данных (например, <code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, <code>application/json</code> и т.д.).</li>
<li>Проверьте пользовательский ввод во избежание распространенных уязвимостей (например: <code>XSS</code>, <code>SQL-инъекций</code>, <code>удаленное выполнение кода</code> и т.д.).</li>
<li>Не передавайте конфиденциальные данные (<code>учетные данные</code>, <code>пароли</code>, <code>токены</code> или <code>ключи API</code>) в URL-адресе, вместо него используйте стандартный заголовок <code>Authorization</code>.</li>
<li>Используйте только шифрование на стороне сервера.</li>
<li>Используйте единый API-шлюз, чтобы можно было настроить кеширование, ограничение на кол-во запросов, Spike Arrest, а также динамическое развертывание API.</li>
</ul>
<h2>Обработка</h2>
<ul>
<li>Проверьте, защищены ли все точки входа аутентификацией, чтобы не нарушить процедуру проверки подлинности.</li>
<li>Следует избегать ID собственного ресурса. Используйте <code>/me/orders</code> вместо <code>/user/654321/orders</code>.</li>
<li>Не используйте автоинкремент для ID. Вместо этого используйте <code>UUID</code>.</li>
<li>Если вы разбираете XML-файлы, убедитесь, что парсинг сущностей выключен, чтобы избежать <code>XXE</code> (XML external entity).</li>
<li>Если вы разбираете XML-файлы, убедитесь, что расширение сущности выключено, чтобы избежать <code>Billion Laughs / XML bomb</code> через атаку экспоненциального расширения сущностей.</li>
<li>Используйте CDN для загрузки файлов.</li>
<li>Если вы имеете дело с огромным количеством данных, используйте Workers and Queues, чтобы обрабатывать как можно больше в фоновом режиме и быстро возвращать ответ, чтобы избежать блокирования HTTP.</li>
<li>Не забудьте выключить режим отладки (debug).</li>
<li>Используйте неисполняемые stack когда они доступны.</li>
</ul>
<h2>Ответ</h2>
<ul>
<li>Отправляйте заголовок <code>X-Content-Type-Options: nosniff</code>.</li>
<li>Отправляйте заголовок <code>X-Frame-Options: deny</code>.</li>
<li>Отправляйте заголовок <code>Content-Security-Policy: default-src &#x27;none&#x27;</code>.</li>
<li>Удалите заголовки, которые могут помочь злоумышленнику в исследовании вашего ресурса на уязвимости - <code>X-Powered-By</code>, <code>Server</code>, <code>X-AspNet-Version</code> и т.д.</li>
<li>Зафиксируйте <code>Content-Type</code> для вашего ответа, если вы возвращаете <code>application/json</code>, тогда запрос должен быть в <code>application/json</code>.</li>
<li>Не возвращайте конфиденциальные данные, такие как <code>учетные данные</code>, <code>пароли</code>, <code>токены</code>.</li>
<li>Возвращайте код состояния в соответствии с итогами обработки. (Например: <code>200 OK</code>, <code>400 Bad Request</code>, <code>401 Unauthorized</code>, <code>405 Method Not Allowed</code> и т.д.).</li>
</ul>
<h2>Непрерывная интеграция и Непрерывная доставка (CI &amp; CD)</h2>
<ul>
<li>Проверяйте ваш проект во время CI/CD. Покрывайте код unit/интеграционными тестами.</li>
<li>Используйте процесс проверки кода (Code Review) коллегами. Не апрувьте сами себя (no Self-Approval).</li>
<li>Убедитесь, что ваше приложение сканируются с помощью антивирусов перед отправкой в прод, включая библиотеки и другие зависимости.</li>
<li>Постоянно запускайте тесты безопасности (статический/динамический анализ) вашего кода.</li>
<li>Проверьте свои зависимости (как программное обеспечение и ОС) на наличие известных уязвимостей.</li>
<li>Сделайте возможным быстрый откат на предыдущую версию.</li>
</ul>
<h2>Мониторинг</h2>
<ul>
<li>Используйте централизованные входы для всех служб и компонентов.</li>
<li>Используйте агенты для мониторинга всего трафика, ошибок, запросов, и ответов.</li>
<li>Используйте оповещения для SMS, Slack, электронной почты, Telegram, Kibana, Cloudwatch, и т.д.</li>
<li>Убедитесь, что вы не регистрируете какие-либо конфиденциальные данные, такие как кредитные карты, пароли, PIN-коды, и т.д.</li>
<li>Используйте систему IDS и/или IPS для мониторинга запросов и экземпляров API.</li>
</ul><small style="display:block;margin-top:8rem" class="jsx-ae369fc9d3d182f"><time class="jsx-ae369fc9d3d182f">2023</time> © Rei000</small></article></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/posts/API-Security","query":{},"buildId":"rjPBkcZE1RiLsuwTT0Glq","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>